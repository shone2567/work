+ mysql -u root -pSuper123
+ cd /root/work/identity_service
++ openssl rand -hex 10
+ ADMIN_TOKEN=58e922d9b8a1e5a8f700
+ echo 'installing keystone package on controller'
installing keystone package on controller
+ yum install -y openstack-keystone openstack-utils httpd mod_wsgi expect
+ yum install -y memcached python-memcached
+ systemctl enable memcached.service
+ systemctl start memcached.service
+ openstack-config --set /etc/keystone/keystone.conf DEFAULT admin_token 58e922d9b8a1e5a8f700
+ openstack-config --set /etc/keystone/keystone.conf database connection mysql+pymysql://keystone:Super123@controller/keystone
+ openstack-config --set /etc/keystone/keystone.conf token provider fernet
+ su -s /bin/sh -c 'keystone-manage db_sync' keystone
+ keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone
+ /usr/sbin/semanage fcontext -a -t keystone_cgi_ra_content_t '/etc/keystone/fernet-keys(/.*)?'
+ /sbin/restorecon -R -v /etc/keystone/fernet-keys
/sbin/restorecon reset /etc/keystone/fernet-keys context unconfined_u:object_r:etc_t:s0->unconfined_u:object_r:keystone_cgi_ra_content_t:s0
/sbin/restorecon reset /etc/keystone/fernet-keys/1 context unconfined_u:object_r:etc_t:s0->unconfined_u:object_r:keystone_cgi_ra_content_t:s0
/sbin/restorecon reset /etc/keystone/fernet-keys/0 context unconfined_u:object_r:etc_t:s0->unconfined_u:object_r:keystone_cgi_ra_content_t:s0
+ ./sub_httpd_edited.sh
ServerName controller
+ ./sub_wsgikeystone_create.sh
+ systemctl enable httpd.service
Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.
+ systemctl start httpd.service
+ export OS_TOKEN=58e922d9b8a1e5a8f700
+ OS_TOKEN=58e922d9b8a1e5a8f700
+ export OS_URL=http://controller:35357/v3
+ OS_URL=http://controller:35357/v3
+ export OS_IDENTITY_API_VERSION=3
+ OS_IDENTITY_API_VERSION=3
+ openstack service create --name keystone --description 'OpenStack Identity' identity
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | OpenStack Identity               |
| enabled     | True                             |
| id          | 0690eb30d7cd40d7b48afd4e76b82295 |
| name        | keystone                         |
| type        | identity                         |
+-------------+----------------------------------+
+ openstack endpoint create --region RegionOne identity public http://controller:5000/v3
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 91e570472c4e4a7ab042a07cf1b21a09 |
| interface    | public                           |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 0690eb30d7cd40d7b48afd4e76b82295 |
| service_name | keystone                         |
| service_type | identity                         |
| url          | http://controller:5000/v3        |
+--------------+----------------------------------+
+ openstack endpoint create --region RegionOne identity internal http://controller:5000/v3
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 5330f081e7834cdea030679807ab8dc4 |
| interface    | internal                         |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 0690eb30d7cd40d7b48afd4e76b82295 |
| service_name | keystone                         |
| service_type | identity                         |
| url          | http://controller:5000/v3        |
+--------------+----------------------------------+
+ openstack endpoint create --region RegionOne identity admin http://controller:35357/v3
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| enabled      | True                             |
| id           | 20208e86f5034208a22996725887f65c |
| interface    | admin                            |
| region       | RegionOne                        |
| region_id    | RegionOne                        |
| service_id   | 0690eb30d7cd40d7b48afd4e76b82295 |
| service_name | keystone                         |
| service_type | identity                         |
| url          | http://controller:35357/v3       |
+--------------+----------------------------------+
+ openstack domain create --description 'Default Domain' default
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Default Domain                   |
| enabled     | True                             |
| id          | 05fedb7006534e68b1f4de0c66110989 |
| name        | default                          |
+-------------+----------------------------------+
+ openstack project create --domain default --description 'Admin Project' admin
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Admin Project                    |
| domain_id   | 05fedb7006534e68b1f4de0c66110989 |
| enabled     | True                             |
| id          | 44d166e20c6645a4917f0bfe22eb44cf |
| is_domain   | False                            |
| name        | admin                            |
| parent_id   | 05fedb7006534e68b1f4de0c66110989 |
+-------------+----------------------------------+
+ openstack user create --domain default --password Super123 admin
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | 05fedb7006534e68b1f4de0c66110989 |
| enabled   | True                             |
| id        | ae7ee50e136a4ec09381e688b698f812 |
| name      | admin                            |
+-----------+----------------------------------+
+ openstack role create admin
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | None                             |
| id        | 8e77dfde59024912bad7b5e9ec172cbd |
| name      | admin                            |
+-----------+----------------------------------+
+ openstack role add --project admin --user admin admin
+ openstack project create --domain default --description 'Service Project' service
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Service Project                  |
| domain_id   | 05fedb7006534e68b1f4de0c66110989 |
| enabled     | True                             |
| id          | b12b83275cf04b3db4b96a2baf3e4b39 |
| is_domain   | False                            |
| name        | service                          |
| parent_id   | 05fedb7006534e68b1f4de0c66110989 |
+-------------+----------------------------------+
+ openstack project create --domain default --description 'Demo Project' demo
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Demo Project                     |
| domain_id   | 05fedb7006534e68b1f4de0c66110989 |
| enabled     | True                             |
| id          | 30310c7f44ec40e89b37da6e76957365 |
| is_domain   | False                            |
| name        | demo                             |
| parent_id   | 05fedb7006534e68b1f4de0c66110989 |
+-------------+----------------------------------+
+ openstack user create --domain default --password Super123 demo
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | 05fedb7006534e68b1f4de0c66110989 |
| enabled   | True                             |
| id        | a8284a868d3e42598b274157223bf4f4 |
| name      | demo                             |
+-----------+----------------------------------+
+ openstack role create user
+-----------+----------------------------------+
| Field     | Value                            |
+-----------+----------------------------------+
| domain_id | None                             |
| id        | 895495e2256442b1bc785a68372ee995 |
| name      | user                             |
+-----------+----------------------------------+
+ openstack role add --project demo --user demo user
+ ./sub_keystone-dist-paste_edited.sh
+ unset OS_TOKEN OS_URL
+ openstack --os-auth-url http://controller:35357/v3 --os-project-domain-name default --os-user-domain-name default --os-project-name admin --os-username admin --os-auth-type password --os-password Super123 token issue
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Field      | Value                                                                                                                                                                                   |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| expires    | 2016-04-30T09:24:06.105943Z                                                                                                                                                             |
| id         | gAAAAABXJGumK3VHyYgALm3T_xLLRYXquaQ6V0tDg5YtjFoRopgwiNkzflNi9ESmNBmt8sAYOw0GxPo7YS_3vHq-nYfxZkq6wmuVOQyt0zHtw7yABHbxJ5OTaM33tMCUqQZDTx5bHKuRMoFJv4d29-ONQhaakmehW8LRetCND8KNnOLAXq6vxHo |
| project_id | 44d166e20c6645a4917f0bfe22eb44cf                                                                                                                                                        |
| user_id    | ae7ee50e136a4ec09381e688b698f812                                                                                                                                                        |
+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
+ /usr/sbin/semanage fcontext -a -t keystone_cgi_ra_content_t '/etc/keystone/fernet-keys(/.*)?'
+ /sbin/restorecon -R -v /etc/keystone/fernet-keys
+ identityResult=0
+ [[ 0 -eq 1 ]]
+ echo 'Pass identity service installation'
Pass identity service installation
+ ./sub_openrc_create.sh
+ exit 0
